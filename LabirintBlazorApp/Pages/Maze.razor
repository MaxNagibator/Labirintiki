@page "/labirint/{seed?}"
@inject SoundService SoundService

<PageTitle>Labirint</PageTitle>
<MudStack Spacing="3">
    <MudText Typo="Typo.h4">Labirint!</MudText>

    @if (_isInit == false)
    {
        <MudStack AlignItems="AlignItems.Center" Row>
            <MudProgressCircular Indeterminate />
            <MudText Typo="Typo.body1">Загрузка..</MudText>
        </MudStack>
    }

    <div class="workspace" hidden="@(!_isInit)">
        <div class="info-panel">
            <MudStack Row Spacing="3">
                <MudStack Row>
                    <MudIcon Color="Color.Warning" Icon="@MaterialDesignIcons.Normal.Bitcoin" Size="Size.Large" />
                    <MudText Color="Color.Warning" Typo="Typo.h6">@_score/@_maxScore</MudText>
                </MudStack>
                <MudStack Row>
                    <MudIcon Color="Color.Inherit" Icon="@MaterialDesignIcons.Normal.Hammer" Size="Size.Large" />
                    <MudText Color="Color.Inherit" Typo="Typo.h6">@_molotCount/@MaxMolotCount</MudText>
                </MudStack>
                <MudStack Row>
                    <MudIcon Color="Color.Error" Icon="@MaterialDesignIcons.Normal.Bomb" Size="Size.Large" />
                    <MudText Color="Color.Error" Typo="Typo.h6"> @_bombaCount/@MaxBombaCount</MudText>
                </MudStack>
            </MudStack>
        </div>

        @if (_isInit)
        {
            <div class="field">
                @{
                    int halfBoxSize = 23;
                }

                @{
                    int wallWidth = Math.Max(1, halfBoxSize / 10 * 2);
                }

                <MazeWalls @ref="_mazeWalls" Maze="_lab" HalfBoxSize="halfBoxSize" WallWidth="wallWidth" Vision="_vision" />
                <MazeSands @ref="_mazeSands" Sand="_sand" HalfBoxSize="halfBoxSize" WallWidth="wallWidth" Vision="_vision" />

                @{
                    int entityBoxSize = halfBoxSize * 2 - wallWidth;
                    (int drawX, int drawY) = (_vision.GetDraw(_player) - 1) * halfBoxSize + wallWidth;
                }
                <div style="position:absolute;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        z-index: 100;
                        left: @(drawX)px;
                        top: @(drawY)px;
                        width: @(entityBoxSize)px;
                        height: @(entityBoxSize)px;">
                    <img src="/images/runner.png" style="width: @(halfBoxSize)px; height: @(halfBoxSize)px;" alt="Бегун" />
                </div>
            </div>
        }

        <div class="control-panel">
            <MudStack Spacing="3">
                <MudText Typo="Typo.h5">Параметры:</MudText>
                <MazeSeed Seed="@Seed" @ref="_seeder" />
                <MudStack>
                    <MudNumericField Label="Размер" Min="@MinSize" Max="@MaxSize" DebounceInterval="300" @bind-Value="_originalSize" />
                    <MudSlider @bind-Value="_originalSize" Min="@MinSize" Max="@MaxSize" Color="Color.Info" Size="Size.Medium" />
                </MudStack>
                <MudStack>
                    <MudNumericField Label="Плотность" Min="0" Max="100" DebounceInterval="300" @bind-Value="_density" />
                    <MudSlider @bind-Value="_density" Min="0" Max="100" Color="Color.Info" Size="Size.Medium" />
                </MudStack>

                <MudButton OnClick="GenerateAsync" Variant="Variant.Outlined" Color="Color.Info" FullWidth>Генерировать</MudButton>
                <KeyInterceptor OnMoveKeyDown="OnMoveKeyDown" OnAttackKeyDown="OnAttackKeyDown" />
            </MudStack>
        </div>
    </div>

</MudStack>
